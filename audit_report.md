# 監査レポート：Secretary Partner AI 現状分析

**日付**: 2025年12月22日
**担当**: Antigravity

## エグゼクティブサマリー
`Secretary_Partner_AI` のバックエンドは、構造的に非常に優れた状態です。クリーンアーキテクチャに厳密に従っており、「Planner（計画）」や「Scheduler（スケジュール）」といった複雑なロジックはすでに実装されています。
主要な不足コンポーネントは **Chrome拡張機能 ("The Eye")** と、スケジュールの計算結果を実際にDBに適用する処理の2点です。

## 1. バックエンドアーキテクチャ（評価：優）
- **構造**: `API -> Service -> Interface -> Infrastructure` の階層構造が厳格に守られています。
- **状態**: SQLite (`sqlite.db`) とモック認証 (`mock_auth.py`) を使用した「ローカルファースト」な構成です。
- **エントリポイント**: `main.py` が8つのサブモジュール（`chat`, `tasks`, `projects` 等）を正しくルーティングしています。

## 2. 機能別 実装状況

| コンポーネント | 状態 | 要件適合度 | 備考 |
| :--- | :--- | :--- | :--- |
| **Planner Agent** | ✅ **高度** | 100% | `planner_service.py` は非常に堅牢です。**リトライ戦略**、**構造化JSON出力**、**Markdownガイド生成**まですでに実装されています。`WorkMemory`の検索ロジックまで組み込まれています。 |
| **Scheduler** | ⚠️ **部分的** | 60% | `scheduler_service.py` には、タスクが収まるか計算するロジック（ナップサック問題的アプローチ）はありますが、計算結果を**実際にDBに適用するアクション**が欠けています。 |
| **Secretary Agent** | ✅ **良好** | 90% | Google ADK `InMemoryRunner` を使用しています。`agent_service.py` 内の独自のストリーミング実装で、ツール呼び出し (Function Calling) も正しく処理されています。 |
| **Capture API** | ✅ **完了** | 100% | `captures.py` とデータモデルは、テキストや画像の受け入れ態勢が整っています。 |
| **Chrome Extension** | ❌ **未着手** | 0% | ディレクトリもコードもまだ存在しません。 |
| **Authentication** | ⚠️ **モック** | 50% | `mock_auth.py` によってセキュリティが無効化されています。拡張機能を統合するには、Firebaseや簡易的なトークン認証など、識別可能な認証基盤が必要です。 |

## 3. 主要な発見と決定事項
1.  **Plannerは修正不要**: 既存の `planner_service.py` は高品質です。これをそのまま利用します。
2.  **Schedulerには「実行」が必要**: 「あふれたタスク」の提案を受けて、それを適用（例：「これら3つを明日に移動」）するツールまたはエンドポイントが必要です。
3.  **拡張機能は「プラグ＆プレイ」でいける**: `api/captures` や `api/chat` が標準的な作りになっているため、Chrome拡張機能はこれらの既存エンドポイントを叩くだけで連携可能です。

## 4. 直近のリスク
- **認証の不一致**: Chrome拡張機能がバックエンドと通信するには「本物のトークン」が必要です。モック認証のままでは、拡張機能の実地テスト（ユーザーとしてログインしてデータを送る）が困難です。
- **CORS設定の脆弱性 (New)**: 開発の利便性のため、`main.py` で `allow_origin_regex=".*"` を設定し、全オリジンからのアクセスを許可しています。これはローカル環境では安全ですが、本番環境でこのままデプロイするとCSRF等の重大なセキュリティリスクとなります。本番化の際は必ず拡張機能ID (`chrome-extension://<ID>`) のみに制限する必要があります。
